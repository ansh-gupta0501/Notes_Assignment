# deploying lambda code from your local IDE to aws

- There are multiple method for this, 
- 1st is make a zip folder of your code file  and upload it directly to lambda . First you need to create a lambda function on aws lambda and there upload option is there .
- 2nd is upload this zip code to s3 bucket and then use it on your lambda. create a s3 bucket and upload your zip file to it .Copy the object url of the object you made after you upload zip file to s3 bucket.  now create a new lambda function and there upload from s3 option where you put that object url . 

- after this change runtime settings of your lambda code 

# Use external libraries in lambda function 

- When we use any external libaries in our code , then files of these external libraries must be there in our lambda function else our code will not work.
- Now when we take all our external library files to our lambda function , our code will get messy . 
- To solve this problem , we use **layers** 
- Suppose there is your execution environment and above that execution environment , you will keep a file system and inside that file system you will install your and put any module, library 

- For this , make a folder node js inside which install axios , now make a zip folder of node js and upload this zip in layers in lambda
- then for particular lambda function select this layer 

```javascript
import axios from 'axios';
export const handler = async (event) => {
 
  try {
    const response = await axios.get('https://docs.aws.amazon.com/lambda/latest/dg/nodejs-layers.html',{
      validateStatus: () => true
    });
    console.log('response', response);

    if(response.status === 200){
      return {
        statusCode: 200,
        body: JSON.stringify('website reached'),
      }
    }
    else{
      console.log('inside else block ');
      
      return {
        statusCode: 500,
        body: JSON.stringify('website not reached'),
      }
    }
   
  } catch (error) {
    console.error("error in catch",error.message);
  } 

  
};

```


---

# share your functions as lambda layer
- Now if there is some function which is reusable in many lambda functions, so we can make that function as layer and in multiple lambda functions just import that function and call it 

- eg we have a file reusablefunction in layers2 > nodejs > node_modules>reusable folder . now we want to use this function in almost 50+ lambda functions , In this there are 2 functions, one is doing database operation , one is just printing on console

```javascript

export function sayHello(){

    console.log('Hello welcome to reusablefunction')
}

export function getDataFromDatabase(name){
    // database command 
    return {'name' : name}
}


```

- now make a zip of this node js folder , and upload it to layers named reusable in aws lambda 
- now make a new lambda function named layers2 and attach this new layer to it 
- after adding layer , if we directly call with function name like  this, we get error , 
```
{
  "errorType": "ReferenceError",
  "errorMessage": "sayHello is not defined",
  "trace": [
    "ReferenceError: sayHello is not defined",
    "    at Runtime.handler (file:///var/task/index.mjs:4:3)",
    "    at Runtime.handleOnceNonStreaming (file:///var/runtime/index.mjs:1205:29)"
  ]
}
```

```javascript
export const handler = async (event) => {
  // TODO implement

  sayHello()
  console.log(getDataFromDatabase("ans"))

  const response = {
    statusCode: 200,
    body: JSON.stringify('Hello from Lambda!'),
  };
  return response;
};



```

- we need to import function first like 

```javascript
import {sayHello,getDataFromDatabase} from 'reusablefunction'

export const handler = async (event) => {
  // TODO implement

  sayHello()
  console.log(getDataFromDatabase("ansh"))

  const response = {
    statusCode: 200,
    body: JSON.stringify('Hello from Lambda!'),
  };
  return response;
};

// note this reusablefunction is now a directory in which we have a file also with same name reusablefunction , we are importing directory/module not file 
```


### Note:- directory structure should be follow like this, where validator is our custom reusable function
```
nodejs/              
└── node_modules/
    └── validator/
        ├── package.json
        └── index.mjs
```
- zip the node js folder and upload to layers

- inside package.json , we have content like 
```json
{
  "name": "reusablefunction",
  "type": "module",
  "main": "reusablefunction.mjs"
}

```

- Now we can add multiple layers to one lambda function , like if we add again axios layer to this lambda function and update our code like
```javascript
import {sayHello,getDataFromDatabase} from 'reusablefunction'
import axios from 'axios'
export const handler = async (event) => {
  // TODO implement

  sayHello()
  console.log(getDataFromDatabase("ansh"))

  const res = await axios.get('https://jsonplaceholder.typicode.com/todos/1')
  console.log(res.data)

  const response = {
    statusCode: 200,
    body: JSON.stringify('Hello from Lambda!'),
  };
  return response;
};

```

- Now we can add maximum of 5  layer to our lambda function but size must not be exceed 250MB